<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
>


<h:head>
    <title>BooksManagement</title>
</h:head>
<h:body>
    <h:form>
        <h:selectOneMenu value="#{Books.author}">
            <f:selectItem itemLabel="Select Author" itemValue="-1" />
            <f:selectItems value="#{Books.authors}" var="author" itemLabel="#{author}" itemValue="#{author}"/>
            <f:ajax render="Titles" listener="#{Books.loadTitles}"/>
        </h:selectOneMenu>
        <h:selectBooleanCheckbox value="#{Books.authorCheckBox}">
            <f:ajax execute="@this"/>
        </h:selectBooleanCheckbox>
        <br/>
        <h:selectOneMenu id="Titles" value="#{Books.title}">
            <f:selectItem itemLabel="Select Title" itemValue="-1" />
            <f:selectItems value="#{Books.titles}" var="title" itemLabel="#{title}" itemValue="#{title}"/>
            <f:ajax execute="@this"/>
        </h:selectOneMenu>
        <h:selectBooleanCheckbox value="#{Books.titleCheckBox}">
            <f:ajax execute="@this"/>
        </h:selectBooleanCheckbox>

        <br/>
        Price from:<h:inputText value="#{Books.priceFrom}">
            <f:ajax execute="@this"/>
        </h:inputText>
        <h:selectBooleanCheckbox value="#{Books.priceFromCheckBox}">
            <f:ajax execute="@this"/>
        </h:selectBooleanCheckbox>
        <br/>
        Price to:<h:inputText value="#{Books.priceTo}">
            <f:ajax execute="@this"/>
        </h:inputText>
        <h:selectBooleanCheckbox value="#{Books.priceToCheckBox}">
            <f:ajax execute="@this"/>
        </h:selectBooleanCheckbox>
        <br/>
        Filter on polish value
        <h:selectBooleanCheckbox value="#{Books.currencyCheckBox}">
            <f:ajax execute="@this"/>
        </h:selectBooleanCheckbox>
        <br/>
        <h:commandButton value="Filter">
            <f:ajax render="@all" listener="#{Books.filterBooks}"/>
        </h:commandButton>

        <table class="order-table" id="table">

            <thead>
            <tr>
                <th class="order-table-header" scope="col">Title</th>
                <th class="order-table-header" scope="col">Author</th>
                <th class="order-table-header" scope="col">Type</th>
                <th class="order-table-header" scope="col">Price</th>
                <th class="order-table-header" scope="col">Currency</th>
                <th class="order-table-header" scope="col">Pages</th>
                <th class="order-table-header" scope="col">Add to cart</th>
            </tr>
            </thead>

            <tbody>
            <ui:repeat value="#{Books.choosenBooks}" var="book">
                <tr>
                    <td>#{book.title}</td>
                    <td>#{book.author}</td>
                    <td>#{book.type}</td>
                    <td>#{book.price}</td>
                    <td>
                        ${book.currency ne 'PLN'}
                        <c:choose>
                            <c:when test="${book.currency ne 'PLN'}">
                                <h:selectOneMenu>
                                    <f:selectItem itemValue="#{book.currency}"/>
                                    <f:selectItem itemValue="PLN"/>
                                </h:selectOneMenu>
                            </c:when>
                            <c:otherwise>
                                #{book.currency}
                            </c:otherwise>
                        </c:choose>
                    </td>
                    <td>#{book.pages}</td>
                    <td>
                        <h:commandButton value="+">
                            <f:ajax listener="#{Books.addToCart(book)}" render="@all"/>
                        </h:commandButton>
                    </td>
                </tr>
            </ui:repeat>
            </tbody>
        </table>

        <br/>        <br/>        <br/>
        CART<br/>
        <table class="order-table" id="cart">

            <thead>
            <tr>
                <th class="order-table-header" scope="col">Title</th>
                <th class="order-table-header" scope="col">Author</th>
                <th class="order-table-header" scope="col">Type</th>
                <th class="order-table-header" scope="col">Price</th>
                <th class="order-table-header" scope="col">Currency</th>
                <th class="order-table-header" scope="col">Pages</th>
                <th class="order-table-header" scope="col">Remove from cart</th>
            </tr>
            </thead>

            <tbody>
            <ui:repeat value="#{Books.cart}" var="book">
                <tr>
                    <td>#{book.title}</td>
                    <td>#{book.author}</td>
                    <td>#{book.type}</td>
                    <td>#{book.price}</td>
                    <td>#{book.currency}</td>
                    <td>#{book.pages}</td>
                    <td>
                        <h:commandButton value="-">
                            <f:ajax listener="#{Books.removeFromCart(book)}" render="@all"/>
                        </h:commandButton>
                    </td>
                </tr>
            </ui:repeat>
            </tbody>
        </table>
    </h:form>
</h:body>
</html>